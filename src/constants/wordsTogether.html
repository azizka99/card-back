<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Batch Text File Concatenator</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for a modern look */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        :root {
            --primary-color: #3b82f6; /* blue-500 */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* gray-100 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        /* Custom styling for the file input button */
        .file-input-label {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            background-color: var(--primary-color);
            color: white;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .file-input-label:hover {
            background-color: #2563eb; /* blue-600 */
            transform: translateY(-1px);
        }

        .file-input-label:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        #fileInput {
            display: none; /* Hide the default input */
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid white;
            width: 1.5rem;
            height: 1.5rem;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

    </style>
</head>
<body>

<div class="bg-white p-8 md:p-10 rounded-xl shadow-2xl w-full max-w-lg transition-all duration-300">
    <h1 class="text-3xl font-extrabold text-gray-800 mb-2 border-b-2 pb-2 border-indigo-100">
        <svg xmlns="http://www.w3.org/2000/svg" class="inline-block w-8 h-8 mr-2 text-indigo-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><line x1="10" y1="9" x2="10" y2="9"></line></svg>
        Text File Concatenator
    </h1>
    <p class="text-gray-500 mb-6">Select multiple plain text files to merge their content into a single downloadable file.</p>

    <!-- File Input Area -->
    <div class="mb-6 flex flex-col items-center">
        <input type="file" id="fileInput" multiple accept=".txt" onchange="handleFileSelection(this.files)">
        <label for="fileInput" class="file-input-label">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
            </svg>
            Select .TXT Files
        </label>
        <p id="fileCount" class="mt-3 text-sm text-gray-600 font-medium"></p>
    </div>

    <!-- Status Message Area -->
    <div id="statusContainer" class="p-4 rounded-lg bg-gray-50 mb-6 border border-gray-200 min-h-[50px] flex items-center justify-center">
        <p id="status" class="text-gray-700 text-center">Ready to process files.</p>
        <div id="loadingIndicator" class="hidden">
            <div class="spinner"></div>
        </div>
    </div>

    <!-- Download Button -->
    <button id="downloadButton" 
            onclick="downloadCombinedFile()" 
            disabled
            class="w-full py-3 bg-green-500 text-white font-bold rounded-lg shadow-md hover:bg-green-600 transition duration-150 ease-in-out disabled:opacity-50 disabled:pointer-events-none flex items-center justify-center">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5 mr-2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
        </svg>
        Download Combined File
    </button>
</div>

<script>
    // Global variable to hold the final Blob object for download
    let combinedTextBlob = null;
    const statusEl = document.getElementById('status');
    const statusContainerEl = document.getElementById('statusContainer');
    const fileCountEl = document.getElementById('fileCount');
    const downloadButtonEl = document.getElementById('downloadButton');
    const loadingIndicatorEl = document.getElementById('loadingIndicator');

    /**
     * Reads a single file and returns its content as a Promise.
     * @param {File} file - The file object to read.
     * @returns {Promise<string>} The content of the file.
     */
    function readFileAsText(file) {
        return new Promise((resolve) => {
            const reader = new FileReader();
            
            reader.onload = (event) => {
                // Return the content
                resolve(event.target.result);
            };

            reader.onerror = () => {
                // On error, return an error message instead of failing the whole process
                // I'm keeping the error message logic here, but it will be separated 
                // by the main '\n\n' separator, not explicit headers/footers.
                resolve(`\n\n--- ERROR: Could not read file ${file.name} ---\n\n`);
            };
            
            // Start reading the file as text
            reader.readAsText(file);
        });
    }

    /**
     * Handles the selection of files, reads them, and combines the content.
     * @param {FileList} files - The list of files selected by the user.
     */
    async function handleFileSelection(files) {
        if (files.length === 0) {
            fileCountEl.textContent = 'No files selected.';
            statusEl.textContent = 'Ready to process files.';
            downloadButtonEl.disabled = true;
            downloadButtonEl.classList.add('opacity-50', 'pointer-events-none');
            return;
        }

        // Reset state
        combinedTextBlob = null;
        downloadButtonEl.disabled = true;
        downloadButtonEl.classList.add('opacity-50', 'pointer-events-none');
        statusEl.textContent = '';
        loadingIndicatorEl.classList.remove('hidden');
        statusContainerEl.classList.add('bg-blue-100');
        fileCountEl.textContent = `Processing ${files.length} file(s)...`;
        
        try {
            // Create an array of Promises for all files
            const readPromises = Array.from(files).map(file => readFileAsText(file));
            
            // Wait for all files to be read simultaneously. 
            // fileContents is now an array of strings (the content of each file).
            const fileContents = await Promise.all(readPromises);

            // Combine the contents using a double newline separator ('\n\n').
            // This ensures that the content of one file is cleanly separated 
            // from the next without file names or headers/footers.
            const finalContent = fileContents.join('\n\n');

            // Store the content as a Blob for download
            combinedTextBlob = new Blob([finalContent], { type: 'text/plain;charset=utf-8' });

            // Update UI for success
            loadingIndicatorEl.classList.add('hidden');
            statusContainerEl.classList.remove('bg-blue-100');
            statusContainerEl.classList.add('bg-green-100');
            statusEl.textContent = `Success! Combined ${files.length} files. Ready for download.`;
            downloadButtonEl.disabled = false;
            downloadButtonEl.classList.remove('opacity-50', 'pointer-events-none');

        } catch (error) {
            // Handle catastrophic errors (e.g., system error)
            console.error("An unexpected error occurred during file processing:", error);
            loadingIndicatorEl.classList.add('hidden');
            statusContainerEl.classList.remove('bg-blue-100');
            statusContainerEl.classList.add('bg-red-100');
            statusEl.textContent = 'An unexpected error occurred. Please check the console.';
        }
    }

    /**
     * Initiates the download of the combined file.
     */
    function downloadCombinedFile() {
        if (!combinedTextBlob) {
            statusContainerEl.classList.remove('bg-green-100');
            statusContainerEl.classList.add('bg-red-100');
            statusEl.textContent = 'Error: No combined content to download. Please select files first.';
            return;
        }

        try {
            const url = URL.createObjectURL(combinedTextBlob);
            const a = document.createElement('a');
            
            // Set download attributes
            a.href = url;
            a.download = `combined_text_batch_${new Date().toISOString().slice(0, 10)}.txt`;
            
            // Programmatically click the link to start the download
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            
            // Clean up the object URL
            URL.revokeObjectURL(url);

            // Update UI
            statusContainerEl.classList.remove('bg-red-100', 'bg-green-100');
            statusContainerEl.classList.add('bg-gray-100');
            statusEl.textContent = 'File downloaded successfully! Select new files to start over.';
            downloadButtonEl.disabled = true;
            downloadButtonEl.classList.add('opacity-50', 'pointer-events-none');

        } catch (e) {
            console.error("Download error:", e);
            statusContainerEl.classList.remove('bg-green-100');
            statusContainerEl.classList.add('bg-red-100');
            statusEl.textContent = 'Download failed.';
        }
    }
</script>
</body>
</html>
